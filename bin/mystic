#!/usr/bin/env ruby

require "mystic"
require "pry"
require "irb"

# Examples:
# mystic create migration InitialMigration
# mystic development migrate
# mystic production rollback


case ARGV[0].to_sym
when :create
  case ARGV[1].to_sym
  when :migration
		Mystic.create_migration ARGV[2].dup
  end
else
	begin
		env = ARGV[1] || ENV["RACK_ENV"] || ENV["RAILS_ENV"] || "development"
		Mystic.connect env
	  case ARGV[0].to_sym
	  when :migrate
	  	Mystic.migrate
	  when :rollback
	  	Mystic.rollback
		when :console
			puts "Starting Mystic console: #{env}"
			IRB.setup nil
			IRB.conf[:MAIN_CONTEXT] = IRB::Irb.new.context
			require "irb/ext/multi-irb"
			IRB.irb nil, IRB::WorkSpace.new
		end
	 	Mystic.disconnect
	rescue Mystic::EnvironmentError => e
		puts e.message
	end
end